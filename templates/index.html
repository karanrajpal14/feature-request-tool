{% extends "base.html" %}
{% block content %}
<section class="hero is-light is-fullheight">
    <!-- Hero head: will stick at the top -->
    <div class="hero-head">
        <div class="container has-text-centered">
            <h1 class="title">Feature Request Tool</h1>
        </div>
    </div>

    <!-- Hero content: will be in the middle -->
    <div class="hero-body">
        <div class="container">
            <div class="columns">
                <div class="column">

                    <div class="columns is-multiline">
                        <div class="column">
                            <div class="card is-narrow">

                                <div class="card-content badge is-badge-large" data-badge="8">
                                    <p class="title">
                                        Notch
                                    </p>
                                    <p class="subtitle">
                                        Because everyone's doing it
                                    </p>
                                </div>
                                <footer class="card-footer">
                                    <p class="card-footer-item">
                                        <span>
                                            Client A
                                        </span>
                                    </p>
                                    <p class="card-footer-item">
                                        <span>
                                            Policies
                                        </span>
                                    </p>
                                    <p class="card-footer-item">
                                        <span>
                                            17/03/1994
                                        </span>
                                    </p>
                                </footer>
                            </div>
                        </div>
                        <div class="column">
                            <div class="card is-narrow">

                                <div class="card-content badge is-badge-large" data-badge="8">
                                    <p class="title">
                                        Notch
                                    </p>
                                    <p class="subtitle">
                                        Because everyone's doing it
                                    </p>
                                </div>
                                <footer class="card-footer">
                                    <p class="card-footer-item">
                                        <span>
                                            Client A
                                        </span>
                                    </p>
                                    <p class="card-footer-item">
                                        <span>
                                            Policies
                                        </span>
                                    </p>
                                    <p class="card-footer-item">
                                        <span>
                                            17/03/1994
                                        </span>
                                    </p>
                                </footer>
                            </div>
                        </div>
                        <div class="column">
                            <div class="card is-narrow">

                                <div class="card-content badge is-badge-large" data-badge="8">
                                    <p class="title">
                                        Notch
                                    </p>
                                    <p class="subtitle">
                                        Because everyone's doing it
                                    </p>
                                </div>
                                <footer class="card-footer">
                                    <p class="card-footer-item">
                                        <span>
                                            Client A
                                        </span>
                                    </p>
                                    <p class="card-footer-item">
                                        <span>
                                            Policies
                                        </span>
                                    </p>
                                    <p class="card-footer-item">
                                        <span>
                                            17/03/1994
                                        </span>
                                    </p>
                                </footer>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="column">
                    <form action="POST" data-bind="submit: save_form_input">

                        <div class="field">
                            <label class="label">Title</label>
                            <div class="control">
                                <input data-bind="value: title" class="input" type="text" placeholder="e.g Add a notch"
                                    id="title">
                            </div>
                        </div>

                        <div class="field">
                            <label class="label">Description</label>
                            <div class="control">
                                <textarea data-bind="value: description" class="textarea" placeholder="e.g. Because everyone's doing it"
                                    id="description"></textarea>
                            </div>
                        </div>

                        <div class="columns">

                            <div class="column is-half">
                                <div class="field">
                                    <label class="label">Client</label>
                                    <div class="control is-expanded">
                                        <div class="select is-fullwidth">
                                            <select data-bind="options: clients, value: selected_client, optionsCaption: 'Select Client'"
                                                id="client">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="column is-half">
                                <div class="field">
                                    <label class="label">Priority</label>
                                    <div class="control is-expanded">
                                        <div class="select is-fullwidth">
                                            <select data-bind="options: priorities, value: selected_priority, optionsCaption: 'Select Priority'"
                                                id="priority">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="columns">
                            <div class="column">
                                <div class="field">
                                    <label class="label">Product Area</label>
                                    <div class="control is-expanded">
                                        <div class="select is-fullwidth">
                                            <select data-bind="options: areas, value: selected_area, optionsCaption: 'Select Product Area'"
                                                id="product_area">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="column">
                                <div class="field">
                                    <label class="label">Deadline</label>
                                    <div class="control">
                                        <input data-bind="value: deadline" class="input flatpickr" type="date" id="deadline">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field is-grouped is-grouped-centered">
                            <div class="control">
                                <button class="button is-primary" type="submit">Submit</button>
                            </div>
                            <div class="control">
                                <button class="button is-danger" type="reset">Cancel</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</section>
{% endblock %}
{% block scripts %}
<script>
    function formBindings() {
        let self = this;

        self.title = ko.observable('');
        self.description = ko.observable('');

        self.clients = ko.observableArray([
            'Client A',
            'Client B',
            'Client C'
        ]);
        self.selected_client = ko.observable('');

        self.priorities = ko.observableArray([
            1, 2, 3, 4, 5, 6, 7, 8, 9, 10
        ]);
        self.selected_priority = ko.observable('');

        self.areas = ko.observableArray([
            'Billing', 'Claims', 'Policies', 'Reports'
        ]);
        self.selected_area = ko.observable('');

        self.deadline = ko.observable('');

        self.post_payload = ko.pureComputed(() => {
            return {
                title: self.title(),
                description: self.description(),
                client: self.selected_client(),
                priority: self.selected_priority(),
                product_area: self.selected_area(),
                deadline: self.deadline()
            }
        }, self);

        self.save_form_input = () => {
            let request = new XMLHttpRequest();
            let data = ko.toJSON(self.post_payload());
            request.open('POST', '/request_feature', true);
            request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
            console.log(data);
            request.send(data);
        }

    }
    ko.applyBindings(new formBindings());
</script>
{% endblock %}